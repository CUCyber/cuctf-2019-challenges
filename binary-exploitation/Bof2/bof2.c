#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <unistd.h>

void win(){
    system("cat ./flag.txt");
    exit(0);
}

void handler(int num){
    printf("Bye!\n");
    exit(-1);
}

int main(int argc, char **argv){
    signal(SIGALRM, handler);
    alarm(5);

    struct {
        char buffer[64];
        volatile int (*fp)();
    } s;

    s.fp = 0;
    printf("Win function is at %p\n", win);
    fflush(stdout);

    gets(s.buffer);

    if(s.fp){
        printf("Calling function pointer, jumping to 0x%lx\n", s.fp);
        if (s.fp == (void *)win){
            s.fp();
        } else {
            printf("[ERROR] Cannot jump to 0x%lx\n", s.fp);
            exit(0);
        }
    } else {
        printf("Better luck next time.\n");
        exit(1);
    }
}
