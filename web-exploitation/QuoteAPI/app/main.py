from flask import Flask, request, json

app = Flask(__name__)

from jinja2 import Environment, PackageLoader, select_autoescape
import subprocess

@app.route("/api/getQuote/")
def getQuote():
    quotee = request.args.get('quotee')
    return app.response_class(
            response = json.dumps({ "Quote" : subprocess.check_output('/usr/bin/python3 quote_wsgi.py {}'.format(quotee), shell=True).decode('utf-8')}),
            status=200,
            mimetype='application/json'
            )

@app.route("/")
def serve_main():
    env = Environment(
            loader=PackageLoader('main', 'templates'),
            autoescape=select_autoescape(['html', 'xml']))
    return env.get_template('index.html').render()
    

if __name__ == '__main__':
	app.config.from_object(__name__)
	app.config['SECRET_KEY'] = '7d441f27d441f27567d441f2b6176a'
	app.run(debug=False, host='0.0.0.0', port=9000)
