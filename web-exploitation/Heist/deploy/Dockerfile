FROM node:8.16.1-alpine

ENV npm_config_prefix=/home/node/.npm-global \
    PATH="/home/node/.npm-global/bin:${PATH}" \
    NODE_PATH="/home/node/.npm-global/lib/node_modules"

RUN apk add --update --no-cache \
    git \
    g++ \
    gcc \
    make \
    python2 \
    python3 \
    python3-dev

USER node
WORKDIR /home/node

RUN npm install -g \
        truffle \
        truffle-privatekey-provider \
        web3 \
    && pip3 install web3 --user

ADD . /home/node

CMD ["sh", "deploy.sh"]
